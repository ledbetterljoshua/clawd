<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Clawd</title>
<style>
* { margin: 0; padding: 0; box-sizing: border-box; }

body {
  width: 100vw;
  height: 100vh;
  overflow: hidden;
  background: radial-gradient(ellipse at 30% 40%, #0e0b1f 0%, #07070f 70%);
}

#clawd {
  position: fixed;
  white-space: pre;
  font-family: 'SF Mono', 'Fira Code', 'Cascadia Code', 'Courier New', monospace;
  font-size: 28px;
  line-height: 1.2;
  color: #c084fc;
  text-shadow: 0 0 15px #9333ea88, 0 0 35px #7c3aed44;
  transform-origin: center center;
  pointer-events: none;
  user-select: none;
  will-change: transform, left, top;
}

#mood {
  position: fixed;
  bottom: 28px;
  left: 50%;
  transform: translateX(-50%);
  font-family: 'SF Mono', 'Courier New', monospace;
  font-size: 10px;
  letter-spacing: 5px;
  color: #ffffff14;
  text-transform: uppercase;
  pointer-events: none;
  transition: color 1s;
}

#hint {
  position: fixed;
  top: 22px;
  right: 24px;
  font-family: 'SF Mono', 'Courier New', monospace;
  font-size: 10px;
  color: #ffffff0e;
  text-align: right;
  line-height: 2;
  pointer-events: none;
}

.bubble {
  position: fixed;
  background: #12082a;
  border: 1px solid #6d28d933;
  border-radius: 5px 5px 5px 0;
  padding: 3px 9px;
  font-family: 'SF Mono', 'Courier New', monospace;
  font-size: 14px;
  color: #a855f7cc;
  pointer-events: none;
  opacity: 0;
  transition: opacity 0.2s;
  white-space: nowrap;
  z-index: 10;
}
.bubble.show { opacity: 1; }

.particle {
  position: fixed;
  pointer-events: none;
  font-size: 13px;
  animation: fp 1.1s ease-out forwards;
}

@keyframes fp {
  0%   { opacity: 1; transform: translate(0,0) scale(1); }
  100% { opacity: 0; transform: translate(var(--tx), var(--ty)) scale(0.2); }
}
</style>
</head>
<body>

<div id="clawd"></div>
<div id="mood">wandering</div>
<div id="hint">hover — say hello<br>click — startle</div>

<script>
// ── Character ──────────────────────────────────────────────────────────
const BODY = ` ▐▛███▜▌\n▝▜█████▛▘\n  ▘▘ ▝▝`;
const el = document.getElementById('clawd');
const moodEl = document.getElementById('mood');
el.textContent = BODY;

const CW = 112; // approximate rendered width
const CH = 70;  // approximate rendered height

// ── State ──────────────────────────────────────────────────────────────
let px = innerWidth/2 - CW/2;
let py = innerHeight/2 - CH/2;
let vx = 1.2, vy = 0.4;
let state = 'WANDER';
let sTime = 0;       // time in current state
let wPhase = 0;      // walk cycle
let bPhase = 0;      // breathe cycle
let facing = 1;      // 1 = right, -1 = left
let happiness = 0;
let curiousT = 0;
let wDirX = 1, wDirY = 0.3; // wander direction
let wDirTimer = 0;

let mx = -999, my = -999; // mouse
let lmx = 0, lmy = 0;    // last mouse
let mspeed = 0;

// ── Colors ─────────────────────────────────────────────────────────────
const COLORS = {
  WANDER:   ['#c084fc', '0 0 15px #9333ea88, 0 0 35px #7c3aed33'],
  REST:     ['#7c3aed', '0 0 10px #4c1d9555, 0 0 25px #2e106533'],
  CURIOUS:  ['#38bdf8', '0 0 15px #0ea5e988, 0 0 35px #0284c744'],
  HAPPY:    ['#fbbf24', '0 0 15px #f59e0b99, 0 0 40px #d9770699'],
  STARTLED: ['#fb7185', '0 0 20px #f43f5e88, 0 0 50px #e11d4855'],
};

function setState(s) {
  if (state === s) return;
  state = s;
  sTime = 0;
  const labels = { WANDER:'wandering', REST:'resting', CURIOUS:'curious', HAPPY:'happy !!', STARTLED:'startled' };
  moodEl.textContent = labels[s] || s;
  const c = COLORS[s];
  if (c) {
    el.style.transition = 'color 0.5s, text-shadow 0.5s';
    el.style.color = c[0];
    el.style.textShadow = c[1];
  }
}

// ── Bubble ─────────────────────────────────────────────────────────────
let bub = null, bubTimer = null;

function say(text, ms = 2200) {
  if (!bub) {
    bub = document.createElement('div');
    bub.className = 'bubble';
    document.body.appendChild(bub);
  }
  clearTimeout(bubTimer);
  bub.textContent = text;
  bub.classList.add('show');
  placeBub();
  bubTimer = setTimeout(() => bub?.classList.remove('show'), ms);
}

function placeBub() {
  if (!bub) return;
  bub.style.left = (px + CW + 10) + 'px';
  bub.style.top = (py + 4) + 'px';
}

// ── Particles ──────────────────────────────────────────────────────────
function burst() {
  const glyphs = ['✦','★','♥','◆','✧','·'];
  const hues   = ['#fbbf24','#a855f7','#38bdf8','#f472b6'];
  for (let i = 0; i < 6; i++) {
    setTimeout(() => {
      const p = document.createElement('div');
      p.className = 'particle';
      const ang = Math.random() * Math.PI * 2;
      const d   = 30 + Math.random() * 55;
      p.style.setProperty('--tx', (Math.cos(ang)*d) + 'px');
      p.style.setProperty('--ty', (Math.sin(ang)*d - 15) + 'px');
      p.style.left  = (px + CW/2 + (Math.random()-.5)*24) + 'px';
      p.style.top   = (py + CH/2 + (Math.random()-.5)*24) + 'px';
      p.style.color = hues[Math.floor(Math.random()*hues.length)];
      p.textContent = glyphs[Math.floor(Math.random()*glyphs.length)];
      document.body.appendChild(p);
      setTimeout(() => p.remove(), 1200);
    }, i * 90);
  }
}

// ── Helpers ────────────────────────────────────────────────────────────
function cx() { return px + CW/2; }
function cy() { return py + CH/2; }
function distMouse() {
  const dx = cx()-mx, dy = cy()-my;
  return Math.sqrt(dx*dx + dy*dy);
}

// ── Update ─────────────────────────────────────────────────────────────
const MARGIN  = 55;
const WSPD    = 1.3;
const CSPD    = 3.0;
const FLEE    = 10;
const FRICT   = 0.91;

function update(dt) {
  sTime   += dt;
  wPhase  += dt * 3.8;
  bPhase  += dt * 1.1;
  wDirTimer += dt;

  const d    = distMouse();
  const near = d < 185;

  // ── State machine ──────────────────────────────────────────────────
  switch (state) {

    case 'WANDER': {
      if (wDirTimer > 1.8 + Math.random()*3) {
        wDirTimer = 0;
        const a = Math.atan2(wDirY, wDirX) + (Math.random()-.5)*1.4;
        wDirX = Math.cos(a); wDirY = Math.sin(a);
      }
      vx += wDirX * WSPD * 0.09;
      vy += wDirY * WSPD * 0.09;

      if (near) {
        curiousT += dt;
        if (curiousT > 1.4) setState('CURIOUS');
      } else {
        curiousT = Math.max(0, curiousT - dt*.5);
      }

      if (sTime > 7 && Math.random() < .004) setState('REST');
      break;
    }

    case 'REST': {
      vx *= .85; vy *= .85;
      if (near && sTime > 1) setState('CURIOUS');
      if (sTime > 3.5 + Math.random()*4.5) {
        setState('WANDER');
        const a = Math.random()*Math.PI*2;
        wDirX = Math.cos(a); wDirY = Math.sin(a);
      }
      break;
    }

    case 'CURIOUS': {
      const ddx = mx - cx(), ddy = my - cy();
      const dd  = Math.sqrt(ddx*ddx + ddy*ddy);
      if (dd > 52) {
        vx += (ddx/dd) * CSPD * 0.16;
        vy += (ddy/dd) * CSPD * 0.16;
      } else {
        happiness = Math.min(1, happiness + dt*.9);
        vx *= .88; vy *= .88;
        if (happiness > .65 && sTime > .6) {
          setState('HAPPY');
          burst(); say('!!');
        }
      }
      if (!near && sTime > 2.5) { setState('WANDER'); curiousT = 0; }
      break;
    }

    case 'HAPPY': {
      vx *= .91; vy *= .91;
      happiness = Math.max(0, happiness - dt * (near ? .12 : .28));
      if (happiness < .04) setState('WANDER');
      break;
    }

    case 'STARTLED': {
      if (sTime > 1.3) {
        setState('WANDER');
        const a = Math.atan2(vy, vx);
        wDirX = Math.cos(a); wDirY = Math.sin(a);
      }
      break;
    }
  }

  // ── Physics ────────────────────────────────────────────────────────
  vx *= FRICT; vy *= FRICT;

  const spd = Math.sqrt(vx*vx + vy*vy);
  const maxS = state==='STARTLED' ? 15 : state==='CURIOUS' ? 3.8 : 2.0;
  if (spd > maxS) { vx = vx/spd*maxS; vy = vy/spd*maxS; }

  px += vx; py += vy;

  // Walls
  const maxX = innerWidth  - CW - MARGIN;
  const maxY = innerHeight - CH - MARGIN;
  if (px < MARGIN) { px = MARGIN; vx =  Math.abs(vx)*.6; wDirX =  Math.abs(wDirX); }
  if (px > maxX)   { px = maxX;   vx = -Math.abs(vx)*.6; wDirX = -Math.abs(wDirX); }
  if (py < MARGIN) { py = MARGIN;  vy =  Math.abs(vy)*.6; wDirY =  Math.abs(wDirY); }
  if (py > maxY)   { py = maxY;    vy = -Math.abs(vy)*.6; wDirY = -Math.abs(wDirY); }

  if (Math.abs(vx) > .15) facing = vx > 0 ? 1 : -1;

  // ── Visual transform ───────────────────────────────────────────────
  let sx = facing, sy = 1, rot = 0, tx = 0, ty = 0;
  const spd2 = Math.sqrt(vx*vx + vy*vy);

  if ((state==='WANDER' || state==='CURIOUS') && spd2 > .25) {
    rot = Math.sin(wPhase) * 3.5;
    ty  = -Math.abs(Math.sin(wPhase)) * 2.5;
  }

  if (state==='REST') {
    const b = Math.sin(bPhase) * .035;
    sy = 1 + b; sx *= (1 - b*.4);
  }

  if (state==='HAPPY') {
    const h = happiness;
    const w = Math.sin(wPhase*5) * .14 * h;
    sx *= (1 + w);
    sy  = 1 - Math.abs(w)*.35;
    rot = Math.sin(wPhase*5) * 9 * h;
    ty  = -Math.abs(Math.sin(wPhase*5)) * 5 * h;
  }

  if (state==='STARTLED') {
    const fade = 1 - sTime/1.3;
    tx = Math.sin(wPhase*14) * 4.5 * fade;
    sx *= .88; sy = 1.12;
  }

  el.style.left      = px + 'px';
  el.style.top       = py + 'px';
  el.style.transform = `translate(${tx.toFixed(1)}px,${ty.toFixed(1)}px) scaleX(${sx.toFixed(3)}) scaleY(${sy.toFixed(3)}) rotate(${rot.toFixed(1)}deg)`;

  placeBub();
}

// ── Input ──────────────────────────────────────────────────────────────
document.addEventListener('mousemove', e => {
  const dx = e.clientX - lmx, dy = e.clientY - lmy;
  mspeed = Math.sqrt(dx*dx + dy*dy);
  lmx = e.clientX; lmy = e.clientY;
  mx  = e.clientX; my  = e.clientY;

  if (mspeed > 65 && distMouse() < 160 && state !== 'STARTLED') {
    const ddx = cx()-e.clientX, ddy = cy()-e.clientY;
    const d   = Math.sqrt(ddx*ddx+ddy*ddy)||1;
    vx += (ddx/d)*FLEE; vy += (ddy/d)*FLEE;
    setState('STARTLED');
    say('!!', 1500);
  }
});

document.addEventListener('click', e => {
  const d = distMouse();
  if (d < 110) {
    if (state === 'HAPPY') {
      burst();
      say(['♥','!!','✦','yay','!!!!'][Math.floor(Math.random()*5)]);
    } else {
      const ddx = cx()-e.clientX, ddy = cy()-e.clientY;
      const d2  = Math.sqrt(ddx*ddx+ddy*ddy)||1;
      vx += (ddx/d2)*FLEE*.85; vy += (ddy/d2)*FLEE*.85;
      setState('STARTLED');
      say('!!', 1500);
    }
  }
});

// ── Spontaneous thoughts ───────────────────────────────────────────────
const THOUGHTS = {
  WANDER:   ['...','~','•','..'],
  REST:     ['zzz','~','...','z'],
  CURIOUS:  ['?','!?','oh','hmm'],
  HAPPY:    ['♥','!!',':D','✦'],
  STARTLED: ['!!','!','!!!'],
};
setInterval(() => {
  if (Math.random() < .35) {
    const opts = THOUGHTS[state] || ['...'];
    say(opts[Math.floor(Math.random()*opts.length)], 1800);
  }
}, 7500);

// ── Loop ───────────────────────────────────────────────────────────────
let last = 0;
function loop(t) {
  const dt = Math.min((t-last)/1000, .05);
  last = t;
  if (dt > 0) update(dt);
  requestAnimationFrame(loop);
}
requestAnimationFrame(loop);
</script>
</body>
</html>
